## Spinup-evaluation {.smaller}

- Spinup is slow. Thousands of simulation years to achieve equilibrium state. Temperature and salinity in deep ocean is slow to converge. 
- Machine learning emulators exist but how do we know if they are correct? Errors can easily propagate - is RMSE MAE sufficient?
- Our focus is on the physical evaluation of ocean models (both equation resolving and AI emulators)
- Implement sustainable software that is easy to extend, robust and reusable. 
- Generalise to be a evaluation benchmark for Climate c.f. Climate-Bench.


## The [ICCS](https://iccs.cam.ac.uk/)^[See <https://iccs.cam.ac.uk/> for more details] {.smaller}

The Institute of Computing for Climate Science

* Domain-specific RSE group based at the University of Cambridge
* Embedded support to several international climate science projects 

![]( ./images/iccs/ICCS_streams.png){fig-align="center"}

::: {.notes}
My background in this is ML and numerical modelling on HPC. 
:::

#

![]( ./images/iccs/BetterSoftwareBetterResearch.png){fig-align="center"}

## NEMO/DINO ocean model


:::: {.columns}

::: {.column style="width:70%;"}

![](./images/DINO-sphere.png){style="width: 50%; background-color: white; padding: 5px;" .absolute bottom=20% left=10%}


:::
::: {.column style="width:30%; font-size: 85%; margin-top: 100px;"}
[{{< fa brands github >}}/vopikamm/DINO](https://github.com/vopikamm/DINO)


![](./images/logos/NEMO_logo.png){style="width: 12%; background-color: white; padding: 5px;" .absolute top=1% right=8%}

<!-- ![](./images/globe_currents.jpg){style="width: 12%; background-color: white; padding: 5px;" .absolute top=3% right=2%} -->

{{< qrcode https://github.com/vopikamm/DINO width=150 height=150 >}}
:::

::: {.absolute style="font-size: 0.6em; bottom: 3%; left: 40%; transform: translateX(-50%);"}
We use the DINO configuration [@kamm2025] for development purposes.
:::

::::




## Is RMSE enough? {auto-animate=true}


::: {style="display: flex; flex-direction: column; align-items: center; justify-content: center;"}

<div style="display: flex; align-items: center; justify-content: center; gap: 2px;">

![](./images/gen1_surface.png){width="70%" style="background-color: white; padding: 2px;"}

![](./images/gen4_surface.png){width="70%" style="background-color: white; padding: 2px;"}

![](./images/reference_surface.png){width="70%" style="background-color: white; padding: 2px;"}

</div>

![](./images/colorbar_density.png){width="50%" style="padding: 5px; margin-top: 5px;"}

:::


::: {.absolute style="font-size: 0.6em; bottom: 3%; left: 20%; transform: translateX(-40%);"}
Evaluation that works even when resolution changes?
:::


## Is RMSE enough? {auto-animate=true}


::: {style="display: flex; flex-direction: column; align-items: center; justify-content: center;"}

<div style="display: flex; align-items: center; justify-content: center; gap: 2px;">

![](./images/gen1_vertical.png){width="70%" style="background-color: white; padding: 2px;"}

![](./images/gen4_vertical.png){width="70%" style="background-color: white; padding: 2px;"}

![](./images/reference_vertical.png){width="70%" style="background-color: white; padding: 2px;"}

</div>

![](./images/colorbar_density.png){width="50%" style="padding: 5px; margin-top: 5px;"}

:::


::: {.absolute style="font-size: 0.6em; bottom: 3%; left: 20%; transform: translateX(-40%);"}
Evaluation that works even when resolution changes?
:::


<!-- ::: {.column style="width:20%;"} -->

<!-- {{< qrcode https://github.com/vopikamm/DINO width=100 height=150 >}}
::: -->

<!-- ::: -->
<!-- ![](./images/DINO_output_ph.png){style="width: 12%; background-color: white; padding: 5px;" .absolute bottom=20% left=10%}

![](./images/DINO_output_ph2.png){style="width: 12%; background-color: white; padding: 5px;" .absolute bottom=20% left=35%} -->


<!-- :::
::: {.column style="width:30%; font-size: 85%; margin-top: 100px;"}
[{{< fa brands github >}}/vopikamm/DINO](https://github.com/vopikamm/DINO) -->


<!-- ![](./images/logos/NEMO_logo.png){style="width: 12%; background-color: white; padding: 5px;" .absolute top=1% right=8%} -->

<!-- ![](./images/globe_currents.jpg){style="width: 12%; background-color: white; padding: 5px;" .absolute top=3% right=2%} -->



<!-- globe currents : https://solstice-wio.org/technologies/high-resolution-ocean-modelling -->



<style>
  .flow-container { position: relative; height: 450px; margin: 20px; }
  .line { position: absolute; left: 0; right: 0; height: 1px; background: linear-gradient(to right, transparent, #555, transparent); opacity: 0.6; }
  
  .box-row { position: absolute; display: flex; align-items: center; gap: 15px; width: 100%; }
  .box { color: white; padding: 15px 30px; border-radius: 8px; text-align: center; font-size: 0.85em; font-weight: bold; min-width: 180px; }
  .label { font-size: 0.6em; color: #ccc; max-width: 350px; }
</style>

## Evaluation-Benchmark

::: {.flow-container}

::: {.line style="top: 35%;"}
:::
::: {.line style="top: 75%;"}
:::

<!-- Curved arrow along left side -->
<!-- <svg class="fragment" data-fragment-index="2" style="position: absolute; left: 0; top: 10%; width: 150px; height: 80%; z-index: 0;" viewBox="0 0 150 500">
  <path d="M 120 0 Q 20 250, 120 500" stroke="#e74c3c" stroke-width="3" fill="none" marker-end="url(#arrowhead-left)" opacity="0.7"/>
  <defs>
    <marker id="arrowhead-left" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#e74c3c" />
    </marker>
  </defs>
</svg> -->

<svg class="fragment" data-fragment-index="2" style="position: absolute; right: 0; top: 10%; width: 150px; height: 80%; z-index: 0;" viewBox="0 0 150 500">
  <path d="M 30 0 Q 130 250, 30 500" stroke="#e74c3c" stroke-width="3" fill="none" marker-end="url(#arrowhead-right)" opacity="0.7"/>
  <defs>
    <marker id="arrowhead-right" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#e74c3c" />
    </marker>
  </defs>
</svg>





::: {.box-row .fragment data-fragment-index="0" style="top: 0; justify-content: flex-end;"}
::: {.label style="text-align: left;"}
 AI emulator or traditional time integrator of physical quantities.
:::
::: {.box style="background-color: #2ecc71;"}
Emulator
:::
:::

::: {.box-row .fragment data-fragment-index="0" style="top: 0; left: 10%;"}
::: {.label style="text-align: left;"}
:::
::: {.box style="background-color: #2ecc71;"}
Ocean Model
:::
:::

<svg class="fragment" data-fragment-index="1" style="position: absolute; top: 55px; left: 150px; width: 40px; height: 330px; z-index: 1;" viewBox="0 0 40 300">
  <path d="M 20 80 L 20 240" stroke="#888" stroke-width="2" fill="none" marker-end="url(#arrowhead)" />
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#888" />
    </marker>
  </defs>
</svg>


::: {.box-row .fragment data-fragment-index="1" style="bottom: -40px; left: 10%; justify-content: flex-start;"}
::: {.box style="background-color: #3498db;"}
Physical-Evaluation
:::
::: {.label style="text-align: left;"}
- Physical evaluation of instantaneous and temporal fields [`GridT`, `restart`].nc
:::
:::

::: {.box-row .fragment data-fragment-index="2" style="top: 55%; left: 30%; transform: translateY(-50%);"}
::: {.box style="background-color: #e74c3c;"}
Translator<br> Toolbox
:::
::: {.label}
- Create `restart` state from AI emulator<br>
- `Convert` states between different models
:::
:::

:::


## Physical evaluation
::: {style="font-size: 0.6em;"}
- Temperature and salinity integrals over physically meaningful geometries relevant to assessing spinup process.
:::

![Figure from *Learning to generate physical ocean states: Towards hybrid climate modeling*. @meunier2025](./images/metrics.png){fig-align="center" width="70%" style="background-color: white; padding: 5px;"}

<!-- ::: {.attribution}
@meunier2025
::: -->


## Developer highlights

### Spinup-evaluation 

:::: {.columns style="gap: 5%;"}

::: {.column style="width:55%;"}

::: {style="font-size: 0.65em;"}
- Compute physical metrics
  - no ground truth
- Execution modes:
  - Evaluate ocean emulators at `end time` only. 
  - Evaluate ocean emulators during roll out over `experiment duration` and check convergence of ocean dynamics.
  - `Correct` emulator predictions by feeding state back into ocean model and then evaluate. 
  - Use as part of AI emulation `optimisation` procedure (i.e. loss function). 
:::

:::

::: {.column style="width:40%; font-size: 65%; padding-left: 30px;"}
[{{< fa brands github >}}/m2lines/spinup-evaluation](https://github.com/vopikamm/DINO)

{{< qrcode https://github.com/m2lines/spinup-evaluation width=150 height=150 >}}

version `0.2.1`
:::

::::




## Developer highlights

### Spinup-evaluation 

:::: {.columns style="gap: 5%;"}

::: {.column style="width:55%;"}

::: {style="font-size: 0.65em;"}
- Computes metrics on restart and grid output files and comparisons if reference provided
- Strict mapping of ocean variables to restart and output variable names
- Relies on utilising spinup-restart/translator to massage outputs into compatible format and incorporate modelling assumptions.
:::

:::

::: {.column style="width:40%; font-size: 65%; padding-left: 30px;"}
[{{< fa brands github >}}/m2lines/spinup-evaluation](https://github.com/vopikamm/DINO)

{{< qrcode https://github.com/m2lines/spinup-evaluation width=150 height=150 >}}

version `0.2.1`
:::

::::



## Developer highlights
### Restart/translator {.smaller}

::: {style="font-size: 0.65em;"}
- Take an emulator state and convert to NEMO compatible restart file
- Regrid; upscale, downscale resolution;
- Apply other physical assumptions:
  - geostrophic velocities
- Translate between other ocean models: $$NEMO \rightleftharpoons Oceananigans \rightleftharpoons OM6$$  
:::

  <!-- - to establish structural uncertainty between different ocean models.  -->

## Software engineering {.smaller}

::: {.columns}

::: {.column width="55%"}
#### **Modular & Generalizable**
- Reusable components across domains
- Extensible to new models (e.g., NEMO, MITgcm)
- Agnostic to file formats & problem sets

<br/>

#### **Quality & Standards**
- Data products adhere to **FAIR** [see @fair2016]
- Robust testing (Unit, Integration, Coverage)
- **Collaborative Design**: Bridging Science & RSE
:::

::: {.column width="45%"}
<!-- ![](./images/rse-collaboration-diagram.png){fig-align="center"} -->

```{mermaid}
%%| fig-width: 4
graph TD
    A(Scientific Expertise) --- C{RSE Bridge}
    B(Software Engineering) --- C
    C --> D[Sustainable Tools]
    
    classDef default fill:#1a365d,stroke:#fff,stroke-width:2px,color:#fff,font-size:18px;
    classDef highlight fill:#84BD00,stroke:#fff,stroke-width:2px,color:#fff,font-size:18px;
    classDef bridge fill:#003E51,stroke:#fff,stroke-width:2px,color:#fff,font-size:18px;

    class A,B default;
    class C bridge;
    class D highlight;
```

> Eliminating silos through cross-disciplinary partnership.
:::

:::

::: {.notes}
- Eliminate siloed workflows through cross-disciplinary partnership.
- Explain how RSEs act as the bridge mentioned in the last bullet.
:::